<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Full Recovery</title>
    <style>
        body { background: #111; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; font-family: sans-serif; }
        #game-container { position: relative; width: 480px; height: 480px; }
        canvas { background: #000; border: 2px solid #333; display: block; width: 100%; height: 100%; }

        /* バトルオーバーレイ */
        #battle-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: black; justify-content: center; align-items: center; z-index: 50; opacity: 0; transition: opacity 0.5s; }
        #battle-overlay.active { opacity: 1; }
        #battle-enemy-img { max-width: 80%; max-height: 80%; object-fit: contain; }

        /* メッセージUI */
        #msg-ui { display: none; position: absolute; bottom: 10px; left: 10px; right: 10px; height: 100px; background: rgba(0,0,0,0.85); color: white; padding: 15px; border: 2px solid #fff; z-index: 100; pointer-events: none; }

        /* スマホ用ボタン (再設置) */
        .controls { width: 480px; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .d-pad { display: grid; grid-template-columns: repeat(3, 50px); grid-template-rows: repeat(3, 50px); }
        .btn { width: 50px; height: 50px; background: #444; color: white; border: none; border-radius: 5px; font-weight: bold; }
        .action-btn { width: 100px; height: 100px; background: #a22; border-radius: 50%; color: white; border: 3px solid #fff; font-size: 18px; }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="g" width="480" height="480" tabindex="1"></canvas>
        <div id="battle-overlay"><img id="battle-enemy-img" src=""></div>
        <div id="msg-ui"></div>
    </div>

    <div class="controls">
        <div class="d-pad">
            <div style="grid-column:2"><button class="btn" onmousedown="Input.keys['up']=true" onmouseup="Input.keys['up']=false" ontouchstart="Input.keys['up']=true" ontouchend="Input.keys['up']=false">▲</button></div>
            <div style="grid-row:2; grid-column:1"><button class="btn" onmousedown="Input.keys['left']=true" onmouseup="Input.keys['left']=false" ontouchstart="Input.keys['left']=true" ontouchend="Input.keys['left']=false">◀</button></div>
            <div style="grid-row:2; grid-column:3"><button class="btn" onmousedown="Input.keys['right']=true" onmouseup="Input.keys['right']=false" ontouchstart="Input.keys['right']=true" ontouchend="Input.keys['right']=false">▶</button></div>
            <div style="grid-row:3; grid-column:2"><button class="btn" onmousedown="Input.keys['down']=true" onmouseup="Input.keys['down']=false" ontouchstart="Input.keys['down']=true" ontouchend="Input.keys['down']=false">▼</button></div>
        </div>
        <button class="action-btn" onclick="window.dispatchEvent(new KeyboardEvent('keydown', {key: ' '}))">ACTION</button>
    </div>

    <script src="maps.js"></script>
    <script src="scenario.js"></script>
    <script src="assets.js"></script>
    <script src="battle_data.js"></script>
    <script src="input.js"></script>
    <script src="renderer.js"></script>
    <script src="battle.js"></script>
    <script src="logic.js"></script>
</body>
</html>